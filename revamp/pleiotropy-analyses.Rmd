---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup 

```{r}

"%&%" <- function(a,b) paste0(a,b)
library("tidyverse")
library("GenomicRanges")
library("viridis")
library("data.table")
library("RColorBrewer")

serv.dir <- "/home/jason/science/servers/FUSE5/"
proj.dir <- serv.dir %&% "projects/t2d_classification/"
work.dir <- proj.dir %&% "revamp/"

analysis.dir <- work.dir %&% "analysis_files/"
plot.dir <- work.dir %&% "plots/"

cred.df <- fread(work.dir %&% "genetic_credible_sets/gencred.txt")
cred.df$Locus.ID <- cred.df$CondID

df1 <- fread(analysis.dir%&%"classified-loci_weighted.txt")
df2 <- fread(analysis.dir%&%"classified-loci_weighted_with-shared.txt")

```


```{r}

(dplyr::select(df2,-contains("assigned_")) %>% arrange(.,desc(islet)) %>% filter(.,islet > 0.9))$symbol %>% unique(.)
(dplyr::select(df2,-contains("assigned_")) %>% arrange(.,desc(liver)) %>% filter(.,liver > 0.9))$symbol %>% unique(.)
(dplyr::select(df2,-contains("assigned_")) %>% arrange(.,desc(adipose)) %>% filter(.,adipose > 0.9))$symbol %>% unique(.)
(dplyr::select(df2,-contains("assigned_")) %>% arrange(.,desc(muscle)) %>% filter(.,muscle > 0.9))$symbol %>% unique(.)

```




# Annotation divvy sums 

```{r}

annot.df <- fread(analysis.dir%&%"annotation-divvy-weighted-unscaled.txt")
annot.mat <- dplyr::select(annot.df,-one_of("Locus.ID"))

```

# Develop "sharing" score

```{r}

df2$sep.score <- map(1:dim(df2)[1],function(i){
  vec <- df2[i,2:6] %>% sort(.,decreasing=TRUE) %>% as.numeric(.)
  vec[1] - vec[2]
}) %>% as.numeric(.)
df2$share.score <- 1-sep.score

df2$num.snps <- map(1:dim(df2)[1],function(i){
  id <- df2[i,]$Locus.ID
  dim(filter(cred.df,CondID==id))[1]
}) %>% as.integer(.)


```


